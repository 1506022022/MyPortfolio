# 쁘띠 마크(가칭)


  <a href="https://youtu.be/fqkyxzn_7ag">
    <img src="https://github.com/1506022022/MyPortfolio/assets/88864717/32e28b88-13d9-4909-bf00-9eb8bd709fd6" width="80%" height="80%">   <br/>
        <a href="https://youtu.be/fqkyxzn_7ag">동영상으로 이동</a>
  </a>




# 프로젝트 구성
|개요|내용|
|---|---|
|장르|플랫포머 디펜스|
|개발기간|2024.05.01 - 2024.06.30(진행중)|
|참여인원|3인|
|개발환경|유니티|

# 담당 구현요소

- **애니메이션**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/3f6e1d60-fcf9-4d93-ab6e-5695ec489341)
```
1. M Animator에 캐릭터 애니메이터를 참조합니다.
2. 자동으로 캐릭터 스테이트에 따른 애니메이션 트리거 매핑이 생성됩니다.
3. 드롭다운 메뉴를 클릭해 캐릭터의 스테이트마다 어떤 트리거를 활성화 시킬 지 지정해 줍니다.
```
캐릭터 애니메이션이 단일 레이어로 구성되고 비교적 단순하기 때문에, 캐릭터 스테이트가 갱신될 때마다 애니메이션 트리거를 핸들링 해서   
캐릭터 애니메이션을 애니메이터가 직접 관리할 수 있도록 구현했습니다.   

또한 트리거 매핑시 유효한 데이터만 사용하기 위해 커스텀 에디터를 사용해 유효한 값으로 드롭다운 메뉴를 생성했습니다.   

##
- **캐릭터 특성**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/9ed60eac-084b-4fcc-91d6-e053ca745a45)
```
1. M Attribute의 M Flags 변수를 설정합니다.
- NonStatic : 이동 가능 여부입니다. 비활성화시 캐릭터가 좌표에 고정됩니다. 활성화시 물리 충돌에 의해 움직입니다.
- Destructibility : 파괴 가능 여부입니다.
- Permeability : 관통 가능 여부입니다. 활성화시 다른 캐릭터가 캐릭터를 통과할 수 있습니다.
- Stickiness : 점착 특성입니다. 활성화시 다른 점착 블록과 부착될 수 있습니다.   
(사용되지 않는 옵션입니다. 상호작용 특성으로 변경 예정입니다.)
```
캐릭터가 가진 고유의 특성입니다.   
   
환경요소 블록을 다양한 타입의 블록으로 확장하기 위해서 캐릭터 특성을 추가했습니다.   
특성들을 조합해 종류의 가지수를 효율적으로 늘릴 수 있도록 플래그 변수를 사용해서 구현했습니다.   
   
캐릭터의 어빌리티와 조합해 시너지 효과를 가집니다.
   
캐릭터 특성을 테스트 해 볼 수 있는 빌드파일 링크 : (https://drive.google.com/file/d/1PFVbyEVSnUtqjqbctOvyuKhADu1GULuD/view?usp=drive_link)
##
- **히트 박스 콜라이더**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/1a94a634-4ace-49dc-b1ac-03077cd89132)
```
1. Hit Delay에 충돌 딜레이를 입력합니다. 충돌 처리는 매 프레임마다 실행되기 때문에 딜레이를 주지 않으면 반복해서 이벤트가 발생합니다. 
2. Mb Attacker에  히트 박스가 공격의 주체인지 피격의 주체인지의 여부를 지정합니다.
같은 타입의 주체끼리는 충돌 처리가 발생하지 않습니다(공격, 공격), (피격, 피격).
3. M Actor에 캐릭터를  참조합니다.
4. M Effect Event에는 충돌시 이벤트를 지정할 수 있습니다. 이펙트, 이벤트, 어빌리티 발동 등.
```
캐릭터 끼리의 충돌 처리를 담당하는 컴포넌트입니다.   
공격의 주체와 피격의 주체로 구분하여 실행됩니다.  
   
충돌은 게임에서 중요하고, 확장할 가능성이 무궁무진하다고 생각해서 파이프라인으로 관리하도록 구현했습니다.  
충돌시 콜리전 데이터를 생성해 히트 박스 파이프라인을 실행합니다.   
콜리전 데이터는 공격과 피격의 주체, 충돌한 히트 박스. 이렇게 3가지 정보를 담고 있습니다.   
   
충돌은 빈번하게 일어나는 만큼 최적화가 중요한 부분이라고 생각해서 충돌 대상의 정보를 가져올때   
인터페이스를 사용해서 정보의 크기를 줄였습니다.   
##
- **골 포털**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/75cc428b-e790-4975-91cb-afeb76ac8828)
```
1. M Run Event에 필요한 이벤트들을 지정합니다.
2. Loader Type 변수를 설정합니다. 포털이 동작하면 GameManager를 통해 다음 콘텐츠를 로드하게 됩니다.
3. Need Characters 변수를 설정합니다. 포털이 동작하기 위해 몇 명의 플레이어 캐릭터가 진입해야 하는지에 대한 조건입니다.  
```
게임의 흐름을 제어하기 위한 방법으로 포털을 이용해 봤습니다.   
포털이 가동되면 GameManager의 콘텐츠 로드 타입을 변경하고 콘텐츠를 불러옵니다.   
   
Stage Loader 타입 지정시 다음 스테이지 씬을 로드합니다.   
Cube Loader 타입 지정시 큐브맵을 회전시켜 육면체에 변화를 줄 수 있습니다.   
Level Loader 타입 지정시 다음 레벨의 콘텐츠를 로드합니다. 현재는 3초 동안 게임을 일시정지 합니다.   

콘텐츠를 로드하는 방식은 위의 타입 이외에도 확장 가능성이 높아 보여서 팩토리 패턴을 사용해 구현해 봤습니다.   
##
- **큐브 맵 오브젝트**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/3c94b137-6127-4936-9d76-1380b976cab5)
```
1. 큐브 맵이 회전했을 때의 변화 이벤트를 지정합니다.
```
큐브 맵은 6면의 플레이 영역을 가졌습니다.   
각 면에 따라 캐릭터에 변화가 생깁니다.   
변화의 폭이 다양해 에디터에서 직접 지정하는 게 자연스럽다고 생각해서 유니티 이벤트를 통해서 구현했습니다.   
큐브 맵의 어느 면이 플레이 영역인지는 옵저버 패턴을 통해서 확인하도록 했습니다.   
##

- **큐브 맵**   
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/5a0dad88-0394-4fac-9592-5aa751e6f95b)
```
- 하나의 플레이 영역에서 6배의 효율을 가져오고 싶어서 맵을 큐브 형태로 설계해 봤습니다.
- 플레이 영역을 6면체의 각 면에 복사하여 붙여넣고, 회전을 통해서 플레이 영역을 바꾸도록 했습니다.
- 회전하여 카메라 전면에 향하게 된 면을 플레이 영역으로 삼습니다. 
- 6개의 플레이 영역은 동일하게 구성되어 있어야 하기 때문에 프리펩으로 만들었습니다.
- 큐브 맵 오브젝트는 카메라 전면부인 하나의 플레이 영역에만 있어도 지장이 없기 때문에 큐브 맵과는 별개로 배치합니다.
```
##
- **몬스터 AI(구현중)**
![image](https://github.com/1506022022/MyPortfolio/assets/88864717/a12e8375-6b67-4d14-b13c-06d3bdc76e10)

```
에셋스토어에서 비헤이비어 디자이너를 구매해 구현했습니다.
간단한 AI의 구현만 요구되었기 때문에 최적화 관점에서 고민되었으나, 팀 작업이기 때문에 프로그래머가 아닌 팀원도
다룰 수 있는 환경을 구축하는 데에는 더 효율적이라고 판단해 비헤이비어 디자이너를 채택했습니다.
디펜스 게임의 특성상 다양한 행동 패턴이 요구될 수 있다고 판단했습니다.
게임에서 사용되는 리소스 또한 로우폴리이기 때문에 해당 기능 구현에서 최적화보단 효율적인 프레임워크가 중요하다고
판단했습니다.

아래와 같은 규칙으로 구현했습니다.
 
1. 우선순위에 따라 캐릭터를 추적합니다.
2. 근접하면 캐릭터를 공격합니다.
3. 공격하면 일정 시간동안 대기시간을 가집니다.
4. 1번으로 돌아갑니다. 
```
